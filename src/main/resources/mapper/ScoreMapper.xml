<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hiep.staff.mapper.ScoreMapper">
	
	<!-- SCORE -->
	<insert id="insertScore">
    INSERT INTO score (student_id, lesson, score, error) 
    VALUES (#{student_id}, #{lesson}, #{score}, #{error})
	</insert>
	
	<select id="getScoreByClassnameAndLesson" resultType="com.hiep.staff.entity.ScoreEntity">
    SELECT 
        s.id AS student_id,
        sc.id AS score_id,
        s.name,
        sc.lesson,
        sc.score,
        sc.error
    FROM 
        student s
    LEFT JOIN 
        score sc ON s.id = sc.student_id AND sc.lesson = #{lesson}
    WHERE 
        s.classname = #{classname}
    GROUP BY 
        s.id, sc.id, s.name, sc.lesson, sc.score, sc.error
    ORDER BY 
        sc.score DESC
	</select>

	<select id="getMaxLesson" resultType="int">
    SELECT MAX(lesson) FROM score
	</select>
	
	<select id="checkLesson" resultType="int">
    SELECT count(*) FROM score where lesson = #{lesson}
	</select>
	
	<select id="hasTestLesson" resultType="boolean">
	SELECT count(*) > 0 
    FROM score 
    WHERE student_id = #{student_id} AND lesson = #{lesson}
	</select>
	
	<update id="updateScore">
        UPDATE score
        SET score = #{score}, error = #{error}
        WHERE student_id = #{student_id} AND lesson = #{lesson};
    </update>


</mapper>